{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/yatinsatija/Desktop/e-medic-new/e-medic-frontend/src/pages/EPHARMACY/Prescription/Prescription.js\";\nimport React, { Component } from \"react\";\nimport \"./Prescription.css\";\nimport firebase from \"../../../Firebase/Firebase\";\nimport { storage, firestore } from \"../../../Firebase/Firebase\";\nimport Axios from \"axios\";\nimport { Redirect, useHistory } from \"react-router-dom\";\nvar Tesseract = window.Tesseract;\n\nclass Prescription extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = async event => {\n      // console.log(event.target.files[0]);\n      var file = event.target.files[0].name;\n      var Extension = file.substring(file.lastIndexOf(\".\") + 1).toLowerCase();\n\n      if (Extension != \"gif\" && Extension != \"png\" && Extension != \"bmp\" && Extension != \"jpeg\" && Extension != \"jpg\") {\n        alert(\"Enter Valid Image File\");\n      } else {\n        if (event.target.files[0]) {\n          // console.log(this.state.file)\n          var uploads = [];\n\n          for (var key in event.target.files) {\n            if (!event.target.files.hasOwnProperty(key)) continue;\n            let upload = event.target.files[key];\n            uploads.push(URL.createObjectURL(upload));\n          }\n\n          await this.setState({\n            uploads: uploads,\n            file: event.target.files[0]\n          });\n        } else {\n          this.setState({\n            uploads: []\n          });\n        }\n\n        const {\n          file\n        } = this.state;\n\n        if (!file) {\n          alert(\"Upload image and then click on upload button\");\n        } else {\n          const uploadTask = storage.ref(`${file.name}`).put(file);\n          uploadTask.on(\"state_changed\", snapShot => {\n            alert(\"uploading in progress\");\n          }, error => {\n            console.log(error);\n          }, () => {\n            storage.ref(\"\").child(file.name).getDownloadURL().then(url => {\n              localStorage.setItem(\"prescription\", url);\n              alert(\"Image_uploaded\");\n              console.log(\"image uploaded\");\n              this.setState({\n                pres: url\n              }, () => console.log(this.state));\n            });\n          });\n        }\n      }\n    };\n\n    this.generateText = async () => {\n      let uploads = this.state.uploads;\n\n      for (var i = 0; i < uploads.length; i++) {\n        await Tesseract.recognize(uploads[i], {\n          lang: \"eng\"\n        }).catch(err => {\n          console.error(err);\n        }).then(result => {\n          // Get Confidence score\n          let confidence = result.confidence; // Get full output\n\n          let text = result.text;\n          localStorage.setItem(\"pcontent\", text); // Get codes\n\n          let pattern = /\\b\\w{10,10}\\b/g;\n          let patterns = result.text.match(pattern); // Update state\n\n          this.setState({\n            patterns: this.state.patterns.concat(patterns),\n            documents: this.state.documents.concat({\n              pattern: patterns,\n              text: text,\n              confidence: confidence //   success: \"button\",\n\n            }),\n            success: \"button\"\n          });\n        });\n      }\n\n      const {\n        name,\n        pres,\n        documents,\n        file\n      } = this.state;\n      console.log(this.state);\n\n      if (!file) {\n        alert(\"Upload image first\");\n      } else {\n        const userRef = firestore.doc(`prescription/${name}`); //const snapShot = await firestore.collection('Users').get();\n\n        console.log(pres);\n        const registeredUser = {\n          name,\n          pres,\n          documents\n        };\n\n        try {\n          await userRef.set(registeredUser);\n          alert(\"Prescription Uploaded\"); //   if(window.location.port){\n          //       window.location.assign(`http://${window.location.hostname}:${window.location.port}/`);\n          //   }\n          //   else{\n          //       window.location.assign(`http://${window.location.hostname}/`);\n          //   }\n        } catch (error) {\n          console.log(error);\n          alert(error.message);\n        }\n      } // console.log(this.state.documents)\n\n    };\n\n    this.goBack = async () => {\n      this.setState({\n        back: true\n      });\n    };\n\n    this.state = {\n      uploads: [],\n      patterns: [],\n      documents: [],\n      file: null,\n      pres: \"\",\n      name: \"Vishal\",\n      success: \"button2\",\n      back: false\n    };\n  }\n\n  render() {\n    if (this.state.back) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 14\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"app\",\n      children: [/*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"hero\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"fileUploaderContainer\",\n          children: [\"Click here to upload prescription\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"fileUploader\",\n            onChange: this.handleChange,\n            multiple: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: this.state.uploads.map((value, index) => {\n            return /*#__PURE__*/_jsxDEV(\"img\", {\n              src: value,\n              width: \"100px\"\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 22\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.generateText,\n          className: \"button\",\n          children: \"Generate content\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"results\",\n        children: this.state.documents.map((value, index) => {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"results__result\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"results__result__image\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: this.state.uploads[index],\n                width: \"250px\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"results__result__info\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"results__result__info__codes\",\n                children: /*#__PURE__*/_jsxDEV(\"small\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Confidence Score:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 193,\n                    columnNumber: 23\n                  }, this), \" \", value.confidence]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 191,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"results__result__info__codes\",\n                children: /*#__PURE__*/_jsxDEV(\"small\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Pattern Output:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 198,\n                    columnNumber: 23\n                  }, this), \" \", value.pattern.map(pattern => {\n                    return pattern + \", \";\n                  })]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 197,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"results__result__info__text\",\n                children: /*#__PURE__*/_jsxDEV(\"small\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Full Output:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 206,\n                    columnNumber: 23\n                  }, this), \" \", value.text]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 205,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 17\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: this.state.success,\n        onClick: this.goBack,\n        children: \"Back to Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default Prescription;","map":{"version":3,"sources":["/Users/yatinsatija/Desktop/e-medic-new/e-medic-frontend/src/pages/EPHARMACY/Prescription/Prescription.js"],"names":["React","Component","firebase","storage","firestore","Axios","Redirect","useHistory","Tesseract","window","Prescription","constructor","props","handleChange","event","file","target","files","name","Extension","substring","lastIndexOf","toLowerCase","alert","uploads","key","hasOwnProperty","upload","push","URL","createObjectURL","setState","state","uploadTask","ref","put","on","snapShot","error","console","log","child","getDownloadURL","then","url","localStorage","setItem","pres","generateText","i","length","recognize","lang","catch","err","result","confidence","text","pattern","patterns","match","concat","documents","success","userRef","doc","registeredUser","set","message","goBack","back","render","map","value","index"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./Prescription.css\";\nimport firebase from \"../../../Firebase/Firebase\";\nimport { storage, firestore } from \"../../../Firebase/Firebase\";\nimport Axios from \"axios\";\nimport { Redirect, useHistory } from \"react-router-dom\";\n\nvar Tesseract = window.Tesseract;\n\nclass Prescription extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      uploads: [],\n      patterns: [],\n      documents: [],\n      file: null,\n      pres: \"\",\n      name: \"Vishal\",\n      success: \"button2\",\n      back: false,\n    };\n  }\n\n  handleChange = async (event) => {\n    // console.log(event.target.files[0]);\n    var file = event.target.files[0].name;\n    var Extension = file.substring(file.lastIndexOf(\".\") + 1).toLowerCase();\n    if (\n      Extension != \"gif\" &&\n      Extension != \"png\" &&\n      Extension != \"bmp\" &&\n      Extension != \"jpeg\" &&\n      Extension != \"jpg\"\n    ) {\n      alert(\"Enter Valid Image File\");\n    } else {\n      if (event.target.files[0]) {\n        // console.log(this.state.file)\n        var uploads = [];\n        for (var key in event.target.files) {\n          if (!event.target.files.hasOwnProperty(key)) continue;\n          let upload = event.target.files[key];\n          uploads.push(URL.createObjectURL(upload));\n        }\n        await this.setState({\n          uploads: uploads,\n          file: event.target.files[0],\n        });\n      } else {\n        this.setState({\n          uploads: [],\n        });\n      }\n      const { file } = this.state;\n      if (!file) {\n        alert(\"Upload image and then click on upload button\");\n      } else {\n        const uploadTask = storage.ref(`${file.name}`).put(file);\n\n        uploadTask.on(\n          \"state_changed\",\n          (snapShot) => {\n            alert(\"uploading in progress\");\n          },\n          (error) => {\n            console.log(error);\n          },\n          () => {\n            storage\n              .ref(\"\")\n              .child(file.name)\n              .getDownloadURL()\n              .then((url) => {\n                localStorage.setItem(\"prescription\", url);\n                alert(\"Image_uploaded\");\n                console.log(\"image uploaded\");\n                this.setState({ pres: url }, () => console.log(this.state));\n              });\n          }\n        );\n      }\n    }\n  };\n  generateText = async () => {\n    let uploads = this.state.uploads;\n\n    for (var i = 0; i < uploads.length; i++) {\n      await Tesseract.recognize(uploads[i], {\n        lang: \"eng\",\n      })\n        .catch((err) => {\n          console.error(err);\n        })\n        .then((result) => {\n          // Get Confidence score\n          let confidence = result.confidence;\n\n          // Get full output\n          let text = result.text;\n          localStorage.setItem(\"pcontent\", text);\n\n          // Get codes\n          let pattern = /\\b\\w{10,10}\\b/g;\n          let patterns = result.text.match(pattern);\n\n          // Update state\n          this.setState({\n            patterns: this.state.patterns.concat(patterns),\n            documents: this.state.documents.concat({\n              pattern: patterns,\n              text: text,\n              confidence: confidence,\n              //   success: \"button\",\n            }),\n            success: \"button\",\n          });\n        });\n    }\n\n    const { name, pres, documents, file } = this.state;\n    console.log(this.state);\n    if (!file) {\n      alert(\"Upload image first\");\n    } else {\n      const userRef = firestore.doc(`prescription/${name}`);\n      //const snapShot = await firestore.collection('Users').get();\n      console.log(pres);\n      const registeredUser = { name, pres, documents };\n\n      try {\n        await userRef.set(registeredUser);\n        alert(\"Prescription Uploaded\");\n        //   if(window.location.port){\n        //       window.location.assign(`http://${window.location.hostname}:${window.location.port}/`);\n        //   }\n        //   else{\n        //       window.location.assign(`http://${window.location.hostname}/`);\n        //   }\n      } catch (error) {\n        console.log(error);\n        alert(error.message);\n      }\n    }\n    // console.log(this.state.documents)\n  };\n  goBack = async () => {\n    this.setState({\n      back: true,\n    });\n  };\n\n  render() {\n    if (this.state.back) {\n      return <Redirect to=\"/checkout\" />;\n    }\n    return (\n      <div className=\"app\">\n        {/* File uploader */}\n        <section className=\"hero\">\n          <label className=\"fileUploaderContainer\">\n            Click here to upload prescription\n            <input\n              type=\"file\"\n              id=\"fileUploader\"\n              onChange={this.handleChange}\n              multiple\n            />\n          </label>\n\n          <div>\n            {this.state.uploads.map((value, index) => {\n              return <img key={index} src={value} width=\"100px\" />;\n            })}\n          </div>\n\n          <button onClick={this.generateText} className=\"button\">\n            Generate content\n          </button>\n        </section>\n\n        {/* Results */}\n        <section className=\"results\">\n          {this.state.documents.map((value, index) => {\n            return (\n              <div key={index} className=\"results__result\">\n                <div className=\"results__result__image\">\n                  <img src={this.state.uploads[index]} width=\"250px\" />\n                </div>\n                <div className=\"results__result__info\">\n                  <div className=\"results__result__info__codes\">\n                    <small>\n                      <strong>Confidence Score:</strong> {value.confidence}\n                    </small>\n                  </div>\n                  <div className=\"results__result__info__codes\">\n                    <small>\n                      <strong>Pattern Output:</strong>{\" \"}\n                      {value.pattern.map((pattern) => {\n                        return pattern + \", \";\n                      })}\n                    </small>\n                  </div>\n                  <div className=\"results__result__info__text\">\n                    <small>\n                      <strong>Full Output:</strong> {value.text}\n                    </small>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </section>\n        <button className={this.state.success} onClick={this.goBack}>\n          Back to Checkout\n        </button>\n      </div>\n    );\n  }\n}\n\nexport default Prescription;\n"]},"metadata":{},"sourceType":"module"}